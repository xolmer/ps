$("#create-customer-form").validate({errorElement:"div",wrapper:"div",errorClass:"form-error farsi",highlight:function(e){$(e).parents(".form-group").addClass("has-error")},unhighlight:function(e){$(e).parents(".form-group").removeClass("has-error")},rules:{first_name:"required",last_name:"required",fathers_name:"required",country_of_residence:"required"},messages:{required:"این فیلد اجباری است",first_name:{required:"لطفا نام مشتری را وارد کنید"},last_name:{required:"لطفا نام خانوادگی مشتری را وارد کنید"},fathers_name:{required:"نام پدر مشتری  اجباری است"},country_of_residence:{required:"کشور محل سکونت مشتری را انتخاب کنید"},".bank_name":{required:"لطفا نام بانک مشتری را وارد کنید"}}}),$(".has-error input").one("keypress",function(){$(this).parents(".form-group").removeClass("has-error").find(".form-errors").remove()}),$(document).ready(function(){var e=function(e){this.id=e,this.country_id=ko.observable(158),this.bank_name=ko.observable(""),this.account_holder_name=ko.observable(""),this.account_number=ko.observable(""),this.remarks=ko.observable(""),this.country=ko.computed(function(){var e=$("#"+this.id).find("select option[value="+this.country_id()+"]").text();return e},this),this.label=ko.computed(function(){return this.country()+(this.bank_name()?" -  "+this.bank_name():"")},this)};e.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.country,delete e.label,delete e.id,e};var o=function(e){this.id=e,this.country_id=ko.observable(158),this.mobile_number=ko.observable(""),this.phone_number=ko.observable(""),this.fax_number=ko.observable(""),this.country=ko.computed(function(){var e=$("#"+this.id).find("select option[value="+this.country_id()+"]").text();return e},this),this.label=ko.computed(function(){return this.country()+(this.mobile_number()?" -  "+this.mobile_number():"")},this)};o.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.country,delete e.label,delete e.id,e};var r=function(e){this.id=e,this.country_id=ko.observable(158),this.address=ko.observable(),this.label=ko.computed(function(){return $("#"+this.id).find("select option[value="+this.country_id()+"]").text()},this)};r.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.label,delete e.id,e};var t=function(){var t=this;t.availableBankNames=[],t.isSaving=ko.observable(!1),t.isSaved=ko.observable(!1),t.customerCreated=ko.observable(!1),t.responseStatus=ko.observable(),t.responseMessage=ko.observable(),t.addNewAccount=function(){t.accounts.push(new e(t.makeID())),$(".bank_name").autocomplete({source:t.availableBankNames})},t.removeAccount=function(e){t.accounts.remove(e)},t.addNewContact=function(){t.contacts.push(new o(t.makeID()))},t.removeContact=function(e){t.contacts.remove(e)},t.addNewAddress=function(){t.addresses.push(new r(t.makeID()))},t.removeAddress=function(e){t.addresses.remove(e)},t.init=function(){$.getJSON("/helpers/banknames",function(e){t.availableBankNames=e})},t.makeID=function(){return"SLT"+Date.now()},t.ccFormSubmitHandler=function(){t.isSaving(!0),t.isSaved(!1);var e=$("div.wizard-summary"),o=$("form#create-customer-form"),r=o.prop("action");e.slideUp("slow");var s=ko.toJSON(t);s=jQuery.parseJSON(s),console.log(s),$.post(r,s).done(function(e){t.responseStatus(e.status),t.responseMessage(e.message),t.customerCreated(!0)}).fail(function(e){console.log(e),t.responseStatus(e.responseJSON.status),t.responseMessage(e.responseJSON.message)}).always(function(){t.isSaving(!1),t.isSaved(!0)})},t.accounts=ko.observableArray([]),t.contacts=ko.observableArray([]),t.addresses=ko.observableArray([]),t.personalDetails={first_name:ko.observable(""),last_name:ko.observable(""),fathers_name:ko.observable(""),national_id:ko.observable(""),passport_number:ko.observable(""),email_address:ko.observable(""),country_of_residence_id:ko.observable(158),remarks:ko.observable("")},t.personalDetails.country=ko.computed(function(){var e="#country option[value="+t.personalDetails.country_of_residence_id()+"]",o=$(e).text();return o}),t.init()};ko.bindingHandlers.displayIfExists={update:function(e,o){var r=ko.unwrap(o());r="string"==typeof r?r.trim():r,$(e).text(r||"_")}},ko.applyBindings(new t)});