$("#create-customer-form").validate({errorElement:"div",wrapper:"div",errorClass:"form-error farsi",highlight:function(e){$(e).parents(".form-group").addClass("has-error")},unhighlight:function(e){$(e).parents(".form-group").removeClass("has-error")},rules:{first_name:"required",last_name:"required",fathers_name:"required",country_of_residence:"required"},messages:{required:"این فیلد اجباری است",first_name:{required:"لطفا نام مشتری را وارد کنید"},last_name:{required:"لطفا نام خانوادگی مشتری را وارد کنید"},fathers_name:{required:"نام پدر مشتری  اجباری است"},country_of_residence:{required:"کشور محل سکونت مشتری را انتخاب کنید"},".bank_name":{required:"لطفا نام بانک مشتری را وارد کنید"}}}),$(document).ready(function(){var e=function(e){this.id=e,this.country_id=ko.observable(158),this.bank_name=ko.observable(""),this.account_holder_name=ko.observable(""),this.account_number=ko.observable(""),this.remarks=ko.observable(""),this.country=ko.computed(function(){var e=$("#"+this.id).find("select option[value="+this.country_id()+"]").text();return e},this),this.label=ko.computed(function(){return this.country()+(this.bank_name()?" -  "+this.bank_name():"")},this)};e.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.country,delete e.label,delete e.id,e};var o=function(e){this.id=e,this.country_id=ko.observable(158),this.mobile_number=ko.observable(""),this.phone_number=ko.observable(""),this.fax_number=ko.observable(""),this.country=ko.computed(function(){var e=$("#"+this.id).find("select option[value="+this.country_id()+"]").text();return e},this),this.label=ko.computed(function(){return this.country()+(this.mobile_number()?" -  "+this.mobile_number():"")},this)};o.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.country,delete e.label,delete e.id,e};var t=function(e){this.id=e,this.country_id=ko.observable(158),this.address=ko.observable(),this.label=ko.computed(function(){return $("#"+this.id).find("select option[value="+this.country_id()+"]").text()},this)};t.prototype.toJSON=function(){var e=ko.toJS(this);return delete e.label,delete e.id,e};var r=function(){var r=this;r.availableBankNames=[],r.isSaving=ko.observable(!1),r.isSaved=ko.observable(!1),r.customerCreated=ko.observable(!1),r.responseStatus=ko.observable(),r.responseMessage=ko.observable(),r.addNewAccount=function(){r.accounts.push(new e(r.makeID())),$(".bank_name").autocomplete({source:r.availableBankNames})},r.removeAccount=function(e){r.accounts.remove(e)},r.addNewContact=function(){r.contacts.push(new o(r.makeID()))},r.removeContact=function(e){r.contacts.remove(e)},r.addNewAddress=function(){r.addresses.push(new t(r.makeID()))},r.removeAddress=function(e){r.addresses.remove(e)},r.init=function(){$.getJSON("/helpers/banknames",function(e){r.availableBankNames=e})},r.makeID=function(){return"SLT"+Date.now()},r.ccFormSubmitHandler=function(){r.isSaving(!0),r.isSaved(!1);var e=$("div.wizard-summary"),o=$("form#create-customer-form"),t=o.prop("action");e.slideUp("slow");var s=ko.toJSON(r);s=jQuery.parseJSON(s),console.log(s),$.post(t,s).done(function(e){r.responseStatus(e.status),r.responseMessage(e.message),r.customerCreated(!0)}).fail(function(e){console.log(e),r.responseStatus(e.responseJSON.status),r.responseMessage(e.responseJSON.message)}).always(function(){r.isSaving(!1),r.isSaved(!0)})},r.accounts=ko.observableArray([]),r.contacts=ko.observableArray([]),r.addresses=ko.observableArray([]),r.personalDetails={first_name:ko.observable(""),last_name:ko.observable(""),fathers_name:ko.observable(""),national_id:ko.observable(""),passport_number:ko.observable(""),email_address:ko.observable(""),country_of_residence_id:ko.observable(158),remarks:ko.observable("")},r.personalDetails.country=ko.computed(function(){var e="#country option[value="+r.personalDetails.country_of_residence_id()+"]",o=$(e).text();return o}),r.init()};ko.bindingHandlers.displayIfExists={update:function(e,o){var t=ko.unwrap(o());t="string"==typeof t?t.trim():t,$(e).text(t||"_")}},ko.applyBindings(new r)});